version: 2.1

jobs:
  deploy_infrastructure:
    docker:
      - image: amazon/aws-cli
    steps:
      - checkout
      - run:
          name: Deploy network
          command: |
            aws cloudformation deploy \
              --template-file network.yml \
              --stack-name udapeople-stack-network
      - run:
          name: Deploy cloudfront
          command: |
            aws cloudformation deploy \
              --template-file cloudfront.yml \
              --stack-name udapeople-stack-cloudfront
      - run:
          name: Deploy backend
          command: |
            aws cloudformation deploy \
              --template-file backend.yml \
              --stack-name udapeople-stack-backend

workflows:
  default:
    jobs:
      - deploy_infrastructure
