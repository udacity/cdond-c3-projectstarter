---
- name: "copy backend distribution files"
  copy:
    src: ~/project/backend/
    dest: ~/app

- name: "Install and Build"
  shell: |
    cd ~/app
    echo "TYPEORM_CONNECTION=${TYPEORM_CONNECTION}" > .env
    echo "TYPEORM_HOST=${TYPEORM_HOST}" >> .env
    echo "TYPEORM_PORT=${TYPEORM_PORT}" >> .env
    echo "TYPEORM_USERNAME=${TYPEORM_USERNAME}" >> .env
    echo "TYPEORM_PASSWORD=${TYPEORM_PASSWORD}" >> .env
    echo "TYPEORM_DATABASE=${TYPEORM_DATABASE}" >> .env
    echo "TYPEORM_MIGRATIONS_DIR=./src/migrations" >> .env
    echo "TYPEORM_MIGRATIONS=./src/migrations/*.ts" >> .env
    echo "TYPEORM_ENTITIES=./src/modules/**/*.entity.ts" >> .env
    npm i
    npm run build

- name: "start pm2"
  shell: |
    pm2 start ~/app/main.js